{
  "Version": "2019-10-30",
  "StartAction": "welcome-message",
  "Actions": [
    {
      "Identifier": "welcome-message",
      "Type": "MessageParticipant",
      "Parameters": {
        "Text": "안녕하세요! Saltware 클라우드 기술 지원센터입니다. 잠시만 기다려 주세요."
      },
      "Transitions": {
        "NextAction": "check-business-hours"
      }
    },
    {
      "Identifier": "check-business-hours",
      "Type": "InvokeExternalResource",
      "Parameters": {
        "FunctionArn": "arn:aws:lambda:ap-northeast-2:${aws_account_id}:function:${environment}-saltware-business-hours",
        "TimeoutSeconds": 8
      },
      "Transitions": {
        "NextAction": "check-business-hours-result",
        "Errors": [
          {
            "ErrorType": "NoMatchingError",
            "NextAction": "lambda-error-fallback"
          }
        ]
      }
    },
    {
      "Identifier": "check-business-hours-result",
      "Type": "CheckAttribute",
      "Parameters": {
        "Attribute": "External.is_business_hours",
        "ComparisonValue": "true"
      },
      "Transitions": {
        "NextAction": "business-hours-routing",
        "Conditions": [
          {
            "NextAction": "after-hours-routing",
            "Condition": {
              "ComparisonValue": "false"
            }
          }
        ],
        "Errors": [
          {
            "ErrorType": "NoMatchingCondition",
            "NextAction": "lambda-error-fallback"
          }
        ]
      }
    },
    {
      "Identifier": "business-hours-routing",
      "Type": "MessageParticipant",
      "Parameters": {
        "Text": "현재 업무시간입니다. 고객 인증을 위해 정보를 확인하겠습니다."
      },
      "Transitions": {
        "NextAction": "transfer-to-agent"
      }
    },
    {
      "Identifier": "after-hours-routing",
      "Type": "MessageParticipant",
      "Parameters": {
        "Text": "현재 업무시간이 아닙니다. 업무시간은 평일 오전 9시부터 오후 6시까지입니다. 이메일로 문의해주세요: support@saltware.co.kr"
      },
      "Transitions": {
        "NextAction": "end-flow"
      }
    },
    {
      "Identifier": "lambda-error-fallback",
      "Type": "MessageParticipant",
      "Parameters": {
        "Text": "시스템 확인 중 문제가 발생했습니다. 상담원과 연결해드리겠습니다."
      },
      "Transitions": {
        "NextAction": "transfer-to-agent"
      }
    },
    {
      "Identifier": "transfer-to-agent",
      "Type": "TransferContactToQueue",
      "Parameters": {
        "QueueId": "${general_queue_id}"
      },
      "Transitions": {
        "NextAction": "end-flow",
        "Errors": [
          {
            "ErrorType": "NoMatchingError",
            "NextAction": "final-fallback"
          }
        ]
      }
    },
    {
      "Identifier": "final-fallback",
      "Type": "MessageParticipant",
      "Parameters": {
        "Text": "죄송합니다. 현재 시스템에 문제가 있습니다. support@saltware.co.kr로 이메일을 보내주시거나 나중에 다시 전화해주세요."
      },
      "Transitions": {
        "NextAction": "end-flow"
      }
    },
    {
      "Identifier": "end-flow",
      "Type": "DisconnectParticipant"
    }
  ]
}